<!DOCTYPE html>
<html>
<head>
    <title>chat room</title>
    <link rel="stylesheet" href="./stylesheets/chat.css">
    <script src="/socket.io/socket.io.js"></script>
    <script>
      window.onload = function(){
          var loginForm = document.querySelector('.login');
          var signupForm = document.querySelector('.signup') || undefined;
          var signupPass = signupForm?signupForm.querySelectorAll('input[type=password]')[0]:"";
          var signupCon = signupForm?signupForm.querySelectorAll('input[type=password]')[1]:"";
          var notification = signupForm?signupForm.querySelector('.notification') : undefined;
          var msgInput = document.querySelector('.msg-input > textarea') || undefined;
          var msgBox = document.querySelector('.messages');

          if(signupForm){
            signupForm.onchange = function(){
              if(signupPass.value && signupCon.value && signupPass.value === signupCon.value){
                notification.style.color = '#42f47d';
                notification.innerHTML = 'Password matching';
              }else if(signupPass.value && signupCon.value && signupPass.value !== signupCon.value){
                notification.style.color = '#bc2e1e';
                notification.innerHTML = 'Password not matching';
              }else{
                console.log('no input');
              }
            }
          }



        var socket = io.connect();
        msgInput.addEventListener('change', function (event){
          console.log(event.target.value);
          socket.emit('sending', event.target.value);
        })
        socket.on('display', msges=>{
          let div_msg = document.createElement('div');
          div_msg.innerHTML = `
          <p id="msg-content">${msges}</p><span id="msg-timing"> (sent time${new Date})</span>
          `
          msgBox.appendChild(div_msg);
          var msgesss = msgBox.querySelectorAll('div');
          for(let i=0; i<msgesss.length; i++){
            if(i%2===0){
              msgesss[i].style.color = "#000";
            }
          }
        });

      }





    </script>
</head>
<body>
    <div class="container">
        <div class="chat-room">
            <h4><%=title%></h4>
            <div class="messages">

            </div>
        </div>
        <div class="profile">
            <%if(!user){%>
            <form class="user login" action="/chat/login" method="post">
                <input type="text" name="username" value="" placeholder="user name">
                <input type="password" name="password" value="" placeholder="password">
                <input type="submit" value="log in">
            </form>
            <br>
            <form class='user signup' action="/chat/signup" method="post">
                <p class="notification"></p>
                <input type="text" name="username" value="" placeholder="key in username to signup" >
                <input type="password" name="password" value="" placeholder="password">
                <input type="password" name="confirmation" value="" placeholder="confirm ur password">
                <input type="submit" value="Sign Up Now">
            </form>

            <%}else{%>
            <span>Welcome Dear</span>
            <strong><%=user.name%></strong>
            <a href="/chat/logout">Logout</a>
            <form class='msg-input' action="/chat/sendmsg" method="post">
                <textarea name="msg"  id="" cols="30" rows="10"></textarea>
                <br>
                <input type="submit" value="Send~">
            </form>
            <%}%>


        </div>

    </div>
    <script>

    </script>
</body>
</html>